#!/usr/bin/env node\n\n// Health check script for Docker and Kubernetes\n// This script is used by the Docker HEALTHCHECK and Kubernetes probes\n\nimport http from 'http'\nimport { URL } from 'url'\n\nconst HEALTH_ENDPOINT = process.env.HEALTH_ENDPOINT || 'http://localhost:8000/api/health/live'\nconst TIMEOUT = parseInt(process.env.HEALTH_TIMEOUT || '3000')\n\nasync function healthCheck() {\n  return new Promise((resolve, reject) => {\n    const url = new URL(HEALTH_ENDPOINT)\n    \n    const request = http.request({\n      hostname: url.hostname,\n      port: url.port || 8000,\n      path: url.pathname,\n      method: 'GET',\n      timeout: TIMEOUT\n    }, (response) => {\n      let data = ''\n      \n      response.on('data', (chunk) => {\n        data += chunk\n      })\n      \n      response.on('end', () => {\n        if (response.statusCode === 200) {\n          try {\n            const health = JSON.parse(data)\n            if (health.status === 'healthy' || health.status === 'alive') {\n              resolve(health)\n            } else {\n              reject(new Error(`Unhealthy status: ${health.status}`))\n            }\n          } catch (error) {\n            // For simple text responses (like \"alive\")\n            if (data.trim().toLowerCase().includes('alive') || data.trim().toLowerCase().includes('healthy')) {\n              resolve({ status: 'alive' })\n            } else {\n              reject(new Error(`Invalid health response: ${data}`))\n            }\n          }\n        } else {\n          reject(new Error(`HTTP ${response.statusCode}: ${response.statusMessage}`))\n        }\n      })\n    })\n    \n    request.on('error', (error) => {\n      reject(error)\n    })\n    \n    request.on('timeout', () => {\n      request.destroy()\n      reject(new Error('Health check timeout'))\n    })\n    \n    request.end()\n  })\n}\n\n// Main execution\nasync function main() {\n  try {\n    const health = await healthCheck()\n    console.log('✅ Health check passed:', health)\n    process.exit(0)\n  } catch (error) {\n    console.error('❌ Health check failed:', error.message)\n    process.exit(1)\n  }\n}\n\nmain()"