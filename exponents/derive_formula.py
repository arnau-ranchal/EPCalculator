#!/usr/bin/env python3
"""
Derive the Eâ‚€^{iid}(Ï) formula from the general definition to verify equivalence.

Starting from:
Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x Q(x) âˆ«_y W(y|x) [âˆ‘_xÌ„ Q(xÌ„) W(y|xÌ„)^{1/(1+Ï)} / W(y|x)^{1/(1+Ï)}]^Ï dy

For AWGN: W(y|x) = (1/Ï€) exp(-|y - âˆšSNRÂ·x|Â²)

Goal: Show this equals the formula with change of variables y = z + âˆšSNRÂ·x
"""

print("="*80)
print("DERIVATION: Eâ‚€^{iid}(Ï) for AWGN Channel")
print("="*80)
print()

print("STEP 1: General formula")
print("-"*80)
print("Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_{xâˆˆğ’³} Q(x) âˆ«_y W(y|x) [...]^Ï dy")
print()
print("where [...] = âˆ‘_{xÌ„âˆˆğ’³} Q(xÌ„) [W(y|xÌ„) / W(y|x)]^{1/(1+Ï)}")
print()

print("STEP 2: AWGN channel model")
print("-"*80)
print("W(y|x) = (1/Ï€) exp(-|y - âˆšSNRÂ·x|Â²)")
print()
print("For real-valued 2-PAM: y, x âˆˆ â„, x âˆˆ {-1, +1}")
print("For complex: y, z âˆˆ â„‚ (we'll use complex notation)")
print()

print("STEP 3: Substitute W(y|x) into the formula")
print("-"*80)
print()
print("W(y|xÌ„) / W(y|x) = exp(-|y - âˆšSNRÂ·xÌ„|Â²) / exp(-|y - âˆšSNRÂ·x|Â²)")
print("                 = exp(-|y - âˆšSNRÂ·xÌ„|Â² + |y - âˆšSNRÂ·x|Â²)")
print()

print("STEP 4: Change of variables")
print("-"*80)
print("Let z = y - âˆšSNRÂ·x  (shift to center noise at origin)")
print()
print("Then: y = z + âˆšSNRÂ·x")
print("      dy = dz  (Jacobian = 1)")
print()
print("Substituting:")
print("  y - âˆšSNRÂ·xÌ„ = z + âˆšSNRÂ·x - âˆšSNRÂ·xÌ„ = z + âˆšSNR(x - xÌ„)")
print()

print("STEP 5: Rewrite W(y|x) in terms of z")
print("-"*80)
print("W(y|x) = (1/Ï€) exp(-|y - âˆšSNRÂ·x|Â²)")
print("       = (1/Ï€) exp(-|z|Â²)")
print()
print("W(y|xÌ„) = (1/Ï€) exp(-|y - âˆšSNRÂ·xÌ„|Â²)")
print("       = (1/Ï€) exp(-|z + âˆšSNR(x - xÌ„)|Â²)")
print()

print("STEP 6: Compute the ratio")
print("-"*80)
print("[W(y|xÌ„) / W(y|x)]^{1/(1+Ï)}")
print()
print("= [(1/Ï€) exp(-|z + âˆšSNR(x-xÌ„)|Â²) / ((1/Ï€) exp(-|z|Â²))]^{1/(1+Ï)}")
print()
print("= [exp(-|z + âˆšSNR(x-xÌ„)|Â² + |z|Â²)]^{1/(1+Ï)}")
print()
print("Let's denote the exponent:")
print("  Î”(x,xÌ„,z) = -|z + âˆšSNR(x-xÌ„)|Â² + |z|Â²")
print()
print("Then: [W(y|xÌ„)/W(y|x)]^{1/(1+Ï)} = exp[Î”(x,xÌ„,z)/(1+Ï)]")
print()

print("STEP 7: Substitute back into Eâ‚€ formula")
print("-"*80)
print()
print("Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x Q(x) âˆ«_z W(z+âˆšSNRÂ·x|x) [âˆ‘_xÌ„ Q(xÌ„) exp(Î”/(1+Ï))]^Ï dz")
print()
print("            = -logâ‚‚ âˆ‘_x Q(x) âˆ«_z (1/Ï€)e^{-|z|Â²} [âˆ‘_xÌ„ Q(xÌ„) exp(Î”/(1+Ï))]^Ï dz")
print()

print("STEP 8: Compare with target formula")
print("-"*80)
print()
print("TARGET formula:")
print("Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x Q(x)/Ï€ âˆ«_z e^{-|z|Â²} [âˆ‘_xÌ„ Q(xÌ„) ((1/Ï€)e^{-|z+âˆšSNR(x-xÌ„)|Â²})^{1/(1+Ï)}")
print("                                                           / ((1/Ï€)e^{-|z|Â²})^{1/(1+Ï)}]^Ï dz")
print()

print("DERIVED formula:")
print("Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x Q(x)/Ï€ âˆ«_z e^{-|z|Â²} [âˆ‘_xÌ„ Q(xÌ„) exp(Î”/(1+Ï))]^Ï dz")
print()

print("where Î”(x,xÌ„,z) = -|z + âˆšSNR(x-xÌ„)|Â² + |z|Â²")
print()

print("STEP 9: Verify the exponent in target formula")
print("-"*80)
print()
print("Target ratio inside [...]:")
print("  [(1/Ï€)e^{-|z+âˆšSNR(x-xÌ„)|Â²}]^{1/(1+Ï)} / [(1/Ï€)e^{-|z|Â²}]^{1/(1+Ï)}")
print()
print("= [(1/Ï€)^{1/(1+Ï)} Â· e^{-|z+âˆšSNR(x-xÌ„)|Â²/(1+Ï)}] / [(1/Ï€)^{1/(1+Ï)} Â· e^{-|z|Â²/(1+Ï)}]")
print()
print("= e^{[-|z+âˆšSNR(x-xÌ„)|Â² + |z|Â²]/(1+Ï)}")
print()
print("= e^{Î”(x,xÌ„,z)/(1+Ï)}")
print()
print("âœ“ This matches our derived formula!")
print()

print("="*80)
print("CONCLUSION")
print("="*80)
print()
print("âœ“âœ“âœ“ YES! The formulas are IDENTICAL. âœ“âœ“âœ“")
print()
print("The target formula from your prompt:")
print("  Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x (Q(x)/Ï€) âˆ« e^{-|z|Â²} [inner]^Ï dz")
print()
print("is exactly the same as the general definition:")
print("  Eâ‚€^{iid}(Ï) = -logâ‚‚ âˆ‘_x Q(x) âˆ« W(y|x) [inner]^Ï dy")
print()
print("obtained by the change of variables z = y - âˆšSNRÂ·x")
print()
print("Key insight:")
print("  - Original integral over y with weight W(y|x) = (1/Ï€)e^{-|y-âˆšSNRÂ·x|Â²}")
print("  - After substitution z = y - âˆšSNRÂ·x:")
print("    â€¢ W(y|x) â†’ (1/Ï€)e^{-|z|Â²}  (noise centered at origin)")
print("    â€¢ dy â†’ dz")
print("    â€¢ Q(x) factor combines with (1/Ï€) to give Q(x)/Ï€")
print()
